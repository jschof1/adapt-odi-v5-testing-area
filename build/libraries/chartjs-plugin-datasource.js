!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("chart.js"),require("xlsx")):"function"==typeof define&&define.amd?define(["chart.js","xlsx"],t):(e=e||self).ChartDataSource=t(e.Chart,e.XLSX)}(this,function(e,c){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,c=c&&c.hasOwnProperty("default")?c.default:c;function t(e,t){this.initialize(e,t)}var a=e.helpers;a.extend(t.prototype,{_defaultConfig:{},_responseType:null,initialize:function(e,t){this._chart=e,this._options=a.extend({},this._defaultConfig,t)},request:function(t){var a=this,e=a.getUrl(),n=new XMLHttpRequest;n.open("GET",e),n.responseType=a._responseType,n.onreadystatechange=function(){var e;4===n.readyState&&(200===n.status&&(e=a.convert(n.response)),t.call(a,{success:200===n.status,data:e}))},n.send()},convert:function(){},getType:function(){return this._options.type},getUrl:function(){return this._options.url}}),t.extend=a.inherits;var n=e.helpers,x={isObject:n.isObject||function(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)},valueOrDefault:n.valueOrDefault||n.getValueOrDefault,getExtension:function(e){e=e.match(/\.([0-9a-z]+)(?:[?#]|$)/i);if(e)return e[1]},transpose:function(e){for(var t,a,n=e[0].length,r=e.length,s=[],i=0;i<n;++i){for(a=[],t=0;t<r;++t)a.push(e[t][i]);s.push(a)}return s},dedup:function(a){return a.filter(function(e,t){return a.indexOf(e)===t})}},r=e.helpers;function u(e){return(e.shift()||[]).map(function(e){return x.valueOrDefault(e,"")})}function p(e){return e.map(function(e){return x.valueOrDefault(e.shift(),"")})}function f(e,t){return r.isFinite(e)&&0<=e&&Math.floor(e)===e?e:t.indexOf(e)}function h(e,t,a){for(var n=f(t,a),r=[],s=0,i=e.length;s<i;++s)r.push(e[s][n]);return x.dedup(r)}var s=t.extend({_defaultConfig:{type:"csv",rowMapping:"dataset",datasetLabels:!0,indexLabels:!0,datapointLabels:!0,datapointLabelMapping:{_dataset:"_dataset",_index:"x"}},_responseType:"text",initialize:function(){var e;t.prototype.initialize.apply(this,arguments),void 0===(e=this._options).delimiter&&(e.delimiter=function(e){switch(x.getExtension(e)){default:return",";case"tsv":return"\t";case"psv":return"|"}}(e.url))},convert:function(e){var t,a,n,r,s,i,o=this._options,l=function(e,t){for(var a,n,r,s,i=new RegExp("("+t+'|\r?\n(?!$)|\r(?!$)|^(?!$))(?:"((?:\\.|""|[^\\"])*)"|([^'+t+'"\r\n]*))',"gi"),o=[],l=[o],d=0;a=i.exec(e);)a[1]&&(a[1]!==t?l.push(o=[]):1===l.length&&0===o.length&&o.push(void 0)),o.push(void 0!==a[2]?a[2].replace(/[\\"](.)/g,"$1"):a[3]||void 0),d=Math.max(d,o.length);for(n=0,r=l.length;n<r;++n)for(s=(o=l[n]).length;s<d;++s)o.push(void 0);return l}(e,o.delimiter),d=[];switch(o.rowMapping){default:!0===o.indexLabels&&(n=u(l)),!0===o.datasetLabels&&(n&&n.shift(),a=p(l)),r=l;break;case"index":!0===o.datasetLabels&&(a=u(l)),!0===o.indexLabels&&(a&&a.shift(),n=p(l)),r=x.transpose(l);break;case"datapoint":!0===o.datapointLabels&&(t=u(l)),a=h(l,o.datapointLabelMapping._dataset,t=void 0===t?["_dataset","x","y","r"]:t),n=h(l,o.datapointLabelMapping._index,t),r=function(e,t,a){for(var n,r,s,i,o,l,d={},u=[],p=0,f=t.length;p<f;++p)u[d[t[p]]=p]=[];for(p=0,f=e.length;p<f;++p)for(r={},o=0,l=(n=e[p]).length;o<l;++o)s=a[o],i=n[o],"_dataset"===s?u[d[i]].push(r):r[s]=i;return u}(l,a,t=function(e,t){for(var a,n,r=Object.keys(t),s=e.slice(),i=0,o=r.length;i<o;++i)-1!==(n=f(t[a=r[i]],e))&&"_index"!==a&&(s[n]=a);return s}(t,o.datapointLabelMapping))}for(a=a||[],s=0,i=r.length;s<i;++s)d.push({label:a[s],data:r[s]});return{labels:n,datasets:d}}});s._extensions=["csv","tsv","psv"];var g=e.helpers;function b(e,t){var a,n,r,s,i,o,l,d,u,p=/(?:,|^)\s*(?:"([^"]*)"|'([^']*)'|([^,\s]*))/gi,f=[];if(void 0===e||void 0===t)return e;if(a=t.match(/(?:\[((?:\[[^\]]*\]|[^\]])*)\]|([^.[]*))(\.?(.*))/)){if(n=a[1],t=a[2],s=(r=a[3])?a[4]:void 0,"*"===t||"*"===n){if(g.isArray(e))for(l=0,d=e.length;l<d;++l)f.push(b(e[l],s));else if(x.isObject(e))for(l=0,d=(u=f._labels=Object.keys(e)).length;l<d;++l)f.push(b(e[u[l]],s));return f}if(void 0!==t)return b(e[t],s);for(u=f._labels=[];a=p.exec(n);)o=void 0!==(i=x.valueOrDefault(a[1],a[2]))?b(e[i],s):b(e,a[3]+r),f.push(o),u.push(x.valueOrDefault(i,a[3]));return 1<f.length?f:f[0]}}function d(e){for(var t,a,n,r,s=e.length,i=[],o=0;o<s;++o)Array.prototype.push.apply(i,e[o]._labels);for(n=(a=x.dedup(i)).length,o=0;o<s;++o){for(i=e[o],t=[],r=0;r<n;++r)t.push(i[i._labels.indexOf(a[r])]);e[o]=t}return a}function v(e,t){for(var a,n=[],r=0,s=e.length;r<s;++r)a=e[r]._labels,n.push(e[r][a?a.indexOf(t):t]);return x.dedup(n)}var i=t.extend({_defaultConfig:{type:"json",rowMapping:"dataset",datapointLabelMapping:{_dataset:"_dataset",_index:"x"}},_responseType:"json",convert:function(e){var t,a,n,r,s,i,o=this._options,l=[];switch(o.data&&(r=b(e,o.data)),o.rowMapping){default:o.datasetLabels?t=b(e,o.datasetLabels):r&&(t=r._labels),o.indexLabels?a=b(e,o.indexLabels):r&&(a=d(r)),n=r;break;case"index":o.datasetLabels?t=b(e,o.datasetLabels):r&&(t=d(r)),o.indexLabels?a=b(e,o.indexLabels):r&&(a=r._labels),r&&(n=x.transpose(r));break;case"datapoint":r&&(t=v(r,o.datapointLabelMapping._dataset),a=v(r,o.datapointLabelMapping._index),n=function(e,t,a){for(var n,r,s,i,o,l,d,u,p=Object.keys(a),f={},c={},h=[],g=0,b=p.length;g<b;++g)"_index"!==(i=p[g])&&(f[a[i]]=i);for(g=0,b=t.length;g<b;++g)h[c[t[g]]=g]=[];for(g=0,b=e.length;g<b;++g)for(r=(n=e[g])._labels,s={},d=0,u=n.length;d<u;++d)i=r?r[d]:d,o=x.valueOrDefault(f[i],i),l=n[d],"_dataset"===o?h[c[l]].push(s):s[o]=l;return h}(r,t,o.datapointLabelMapping))}for(t=t||[],n=n||[],s=0,i=Math.max(t.length,n.length);s<i;++s)l.push({label:t[s],data:n[s]});return{labels:a,datasets:l}}});i._extensions=["json"];var o=i.extend({_defaultConfig:{type:"jsonl",rowMapping:"index",datapointLabelMapping:{_dataset:"_dataset",_index:"x"}},_responseType:"text",convert:function(e){e=JSON.parse("["+e.trim().split("\n").join(",")+"]");return i.prototype.convert.call(this,e)}});o._extensions=["jsonl"];var l=e.helpers;function _(e,t){for(var a,n,r,s,i;t;){if(t.match(/^(([A-Z]+\d*|[A-Z]*\d+):([A-Z]+\d*|[A-Z]*\d+)|[A-Z]+\d+)$/)){s=t;break}if(n)break;a=t.match(/^(?:'([^']*)'|([^!]*))(?:!(.*))?$/),n=x.valueOrDefault(a[1],a[2]),t=a[3]}return i=(r=e.Sheets[x.valueOrDefault(n,e.SheetNames[0])])?r["!ref"]:"",e=c.utils.decode_range(x.valueOrDefault(s,i)),i&&(i=c.utils.decode_range(i),-1===e.s.c&&(e.s={c:i.s.c,r:e.s.r}),-1===e.e.c&&(e.e={c:i.e.c,r:e.e.r}),isNaN(e.s.r)&&(e.s={c:e.s.c,r:i.s.r}),isNaN(e.e.r)&&(e.e={c:e.e.c,r:i.e.r})),{sheet:r,range:e,detected:void 0===s}}function y(e,t){var a,n,r,s,i,o,l=e.sheet,d=e.range,u=t&&t.columnOriented?"c":"r",p=t&&t.columnOriented?"r":"c",f=[];if(!l)return f;for(r=d.s[u],i=d.e[u];r<=i;++r){for(a=[],s=d.s[p],o=d.e[p];s<=o;++s)(n={})[u]=r,n[p]=s,n=(l[c.utils.encode_cell(n)]||{}).v,t&&t.header&&(n=x.valueOrDefault(n,"")),a.push(n);f.push(1<a.length?a:a[0])}return f}function L(e){var t=l.clone(e.range);if(!(t.s.r>=t.e.r))return t.e.r=t.s.r,e.range.s.r++,y({sheet:e.sheet,range:t},{columnOriented:!0,header:!0})}function O(e){var t=l.clone(e.range);if(!(t.s.c>=t.e.c))return t.e.c=t.s.c,e.range.s.c++,y({sheet:e.sheet,range:t},{header:!0})}function w(e,t,a){return e.match(/^[A-Z]+$/)?c.utils.decode_col(e)-a:t.indexOf(e)}function m(e,t,a){var n=l.clone(e.range),a=w(t,a,n.s.c);return n.s.c=n.e.c=-1!==a?a+n.s.c:a,x.dedup(y({sheet:e.sheet,range:n},{header:!0}))}n=t.extend({_defaultConfig:{type:"sheet",rowMapping:"dataset",datapointLabelMapping:{_dataset:"_dataset",_index:"x"}},_responseType:"arraybuffer",initialize:function(){if(!c)throw new Error("XLSX is not found. Please load the xlsx library before loading this plugin.");t.prototype.initialize.apply(this,arguments)},convert:function(e){var t,a,n,r,s,i,o=this._options,l=c.read(new Uint8Array(e),{type:"array"}),d=_(l,x.valueOrDefault(o.data,"")),u=d.detected,p=[];switch(o.rowMapping){default:o.indexLabels?n=y(_(l,o.indexLabels),{columnOriented:!0,header:!0}):u&&(n=L(d)),o.datasetLabels?a=y(_(l,o.datasetLabels),{header:!0}):u&&(n&&n.shift(),a=O(d)),r=y(d);break;case"index":o.datasetLabels?a=y(_(l,o.datasetLabels),{columnOriented:!0,header:!0}):u&&(a=L(d)),o.indexLabels?n=y(_(l,o.indexLabels),{header:!0}):u&&(a&&a.shift(),n=O(d)),r=y(d,{columnOriented:!0});break;case"datapoint":o.datapointLabels?t=y(_(l,o.datapointLabels),{columnOriented:!0,header:!0}):u&&(t=L(d)),a=m(d,o.datapointLabelMapping._dataset,t=void 0===t?["_dataset","x","y","r"]:t),n=m(d,o.datapointLabelMapping._index,t),t=function(e,t){for(var a,n,r=Object.keys(t),s=e.slice(),i=0,o=r.length;i<o;++i)-1!==(n=w(t[a=r[i]],e))&&"_index"!==a&&(s[n]=a);return s}(t,o.datapointLabelMapping),r=function(e,t,a){for(var n,r,s,i,o,l,d={},u=[],p=0,f=t.length;p<f;++p)u[d[t[p]]=p]=[];for(p=0,f=e.length;p<f;++p)for(r={},o=0,l=(n=e[p]).length;o<l;++o)s=a[o],i=n[o],"_dataset"===s?u[d[i]].push(r):r[s]=i;return u}(y(d),a,t)}for(a=a||[],r=r||[],s=0,i=Math.max(a.length,r.length);s<i;++s)p.push({label:a[s],data:r[s]});return{labels:n,datasets:p}}});n._extensions=["xlsx","xlsm","xlsb","xls","xlw","xml","csv","txt","dif","sylk","slk","prn","ods","fods","uos","dbf","wks","wk1","wk2","wk3","wk4","123","wq1","wq2","wb1","wb2","wb3","qpw","html","htm","eth"];var n={csv:s,json:i,jsonl:o,sheet:n},M=e.helpers;e.defaults.global.plugins.datasource={};var j={id:"datasource",beforeInit:function(e){e.$datasource={}},beforeUpdate:function(t,e){var a=t.$datasource,n=e.url,r=e.type||this.getType(n),s=this.getConstructor(r),i=a._datasource;if(n&&s&&!t.$datasource._delayed)return(i=!i||i.getType()!==r||i.getUrl()!==n?a._datasource=new s(t,e):i).request(function(e){!function(e,t){var a,n,r,s,i,o=t.datasets,l=e.datasets,t=t.labels,d=e.labels,u=0;if(M.isArray(o))for(M.isArray(l)||(l=e.datasets=[]),s=0,i=o.length;s<i;++s)r=o[s],a=l[s],x.isObject(a)||(a=l[s]={}),void 0!==(n=r.label)?a.label=n:void 0===a.label&&(a.label="Dataset "+(s+1)),r=r.data,M.isArray(r)&&(a.data=r,u=Math.max(u,r.length));if(M.isArray(t))e.labels=t;else if(!M.isArray(d)||!d.length)for(d=e.labels=[],s=0;s<u;++s)d[s]=""+(s+1)}(t.data,e.data),a._delayed=!0,t.update(),delete a._delayed}),!1},constructors:{},extensions:{},register:function(t,e,a){var n=this;n.constructors[t]=e,M.each(a,function(e){n.extensions[e]=t})},getType:function(e){if(e)return this.extensions[x.getExtension(e)]||"json"},getConstructor:function(e){if(!this.constructors.hasOwnProperty(e))throw new Error('"'+e+'" is not a data source type.');return this.constructors[e]}};return e.helpers.each(n,function(e,t){j.register(t,e,e._extensions,e._defaults)}),j});